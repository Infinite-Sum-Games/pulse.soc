// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: profile.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const fetchProfileQuery = `-- name: FetchProfileQuery :one
SELECT
  ua.email,
  ua.ghUsername,
  ua.first_name,
  ua.middle_name,
  ua.last_name,
  ua.bounty,
  COUNT(DISTINCT CASE WHEN s.is_merged = true THEN s.id END) as solutions_accepted,
  COUNT(DISTINCT CASE WHEN s.is_merged = false THEN s.id END) as solutions_pending,
  COUNT(DISTINCT ic.id) as active_claims,
  ARRAY_AGG(DISTINCT bd.badge_name) as badges
FROM 
  user_account ua
LEFT JOIN solutions s 
  ON s.ghUsername = ua.ghUsername
LEFT JOIN issue_claims ic 
  ON ic.ghUsername = ua.ghUsername
LEFT JOIN issues i 
  ON i.id = ic.issue_id 
  AND i.resolved = false 
  AND ic.elapsed_on > NOW()
LEFT JOIN badge_dispatch bd
  ON bd.ghUsername = ua.ghUsername
WHERE
  ua.status = true
  AND ua.ghUsername = $1
GROUP BY
  ua.email,
  ua.ghUsername,
  ua.first_name,
  ua.middle_name,
  ua.last_name,
  ua.bounty
`

type FetchProfileQueryRow struct {
	Email             string      `json:"email"`
	Ghusername        pgtype.Text `json:"ghusername"`
	FirstName         string      `json:"first_name"`
	MiddleName        pgtype.Text `json:"middle_name"`
	LastName          string      `json:"last_name"`
	Bounty            int32       `json:"bounty"`
	SolutionsAccepted int64       `json:"solutions_accepted"`
	SolutionsPending  int64       `json:"solutions_pending"`
	ActiveClaims      int64       `json:"active_claims"`
	Badges            interface{} `json:"badges"`
}

func (q *Queries) FetchProfileQuery(ctx context.Context, db DBTX, ghusername pgtype.Text) (FetchProfileQueryRow, error) {
	row := db.QueryRow(ctx, fetchProfileQuery, ghusername)
	var i FetchProfileQueryRow
	err := row.Scan(
		&i.Email,
		&i.Ghusername,
		&i.FirstName,
		&i.MiddleName,
		&i.LastName,
		&i.Bounty,
		&i.SolutionsAccepted,
		&i.SolutionsPending,
		&i.ActiveClaims,
		&i.Badges,
	)
	return i, err
}
